(()=>{"use strict";var e,t,n=document.querySelector("#card-template").content;function o(e,t,o,r,c){var a=n.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__image"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__like-numbers");return a.querySelector(".card__title").textContent=e.name,u.src=e.link,u.alt=e.name,l.textContent=e.likes.length,e.owner._id===c&&(i.classList.remove("card__delete-button-hidden"),i.addEventListener("click",(function(){t(e._id,a)}))),e.likes.forEach((function(e){e._id===c&&s.classList.add("card__like-button_is-active")})),s.addEventListener("click",(function(){o(e._id,s,l)})),u.addEventListener("click",r),a}function r(n,o){e=n,t=o,n.classList.add("popup_is-opened"),o.addEventListener("click",c),n.addEventListener("click",a),document.addEventListener("keydown",i)}function c(){u(e,t)}function a(n){n.target===n.currentTarget&&u(e,t)}function i(n){"Escape"===n.key&&u(e,t)}function u(n,o){n.classList.remove("popup_is-opened"),o.removeEventListener("click",c),n.removeEventListener("click",a),document.removeEventListener("keydown",i),e=void 0,t=void 0}function s(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.textContent="",r.classList.remove(o)}function l(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass;e.reset();var i=Array.from(e.querySelectorAll(n));!function(e,t){e.disabled=!0,e.classList.add(t)}(e.querySelector(o),r),i.forEach((function(t){s(e,t,c,a)}))}function d(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function f(){return fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me",{method:"GET",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.error(e)}))}function p(e){document.querySelector(".popup_is-opened").querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var h,v,_,y,b,S,E,k,q=document.querySelector(".places__list"),L=document.querySelectorAll(".popup"),C=document.querySelector(".profile__edit-button"),j=document.querySelector(".profile__add-button"),g=document.querySelector(".avatar__edit-button"),w=document.querySelector(".popup_type_edit"),A=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_image"),x=document.querySelector(".popup_delete-card"),P=document.querySelector(".popup_new-avatar"),z=w.querySelector(".popup__close"),D=A.querySelector(".popup__close"),O=T.querySelector(".popup__close"),B=x.querySelector(".popup__close"),M=P.querySelector(".popup__close"),N=document.querySelector(".popup__image"),I=document.querySelector(".popup__caption"),J=document.forms["edit-profile"],G=document.forms["new-place"],H=document.forms["confirm-delete"],U=document.forms["new-avatar"],V=J.elements.name,$=J.elements.description,F=G.elements["place-name"],K=G.elements.link,Q=U.elements.avatar,R=document.querySelector(".profile__title"),W=document.querySelector(".profile__description"),X=document.querySelector(".profile__image"),Y=J.elements.name,Z=J.elements.description,ee={},te={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function ne(e,t){ee={id:e,cardElement:t},r(x,B)}function oe(e,t,n){t.classList.contains("card__like-button_is-active")?function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))}(e).then((function(e){n.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(e){return console.error(e)})):function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))}(e).then((function(e){n.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(e){return console.error(e)}))}function re(e){N.src=e.srcElement.currentSrc,N.alt=e.srcElement.alt,I.textContent=e.srcElement.alt,r(T,O)}_=(v=te).formSelector,y=v.inputSelector,b=v.submitButtonSelector,S=v.inactiveButtonClass,E=v.inputErrorClass,k=v.errorClass,Array.from(document.querySelectorAll(_)).forEach((function(e){e.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),i=e.querySelector(n);d(a,i,o),a.forEach((function(t){t.addEventListener("input",(function(){d(a,i,o),function(e,t,n,o){t.validity.valid?s(e,t,n,o):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o))}(e,t,r,c)}))}))}(e,y,b,S,E,k)})),Promise.all([f(),fetch("https://nomoreparties.co/v1/wff-cohort-20/cards",{method:"GET",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=(r[0],r[1]);!function(e,t,n){f().then((function(o){h=o._id,e.textContent=o.name,t.textContent=o.about,n.setAttribute("style","background-image: url(".concat(o.avatar,");"))}))}(R,W,X),c.forEach((function(e){q.append(o(e,ne,oe,re,h))}))})).catch((function(e){return console.error(e)})),L.forEach((function(e){e.classList.add("popup_is-animated")})),C.addEventListener("click",(function(){r(w,z),l(J,te),Y.value=R.textContent,Z.value=W.textContent})),j.addEventListener("click",(function(){r(A,D),l(G,te)})),g.addEventListener("click",(function(e){r(P,M),l(U,te)})),J.addEventListener("submit",(function(e){var t,n;e.preventDefault(),p(!0),(t=V.value,n=$.value,fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me",{method:"PATCH",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),about:"".concat(n)})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))).then((function(){R.textContent=V.value,W.textContent=$.value})).then((function(){p(!1),u(w,z)})).catch((function(e){return console.error(e)}))})),G.addEventListener("submit",(function(e){var t,n;e.preventDefault(),p(!0),(t=F.value,n=K.value,fetch("https://nomoreparties.co/v1/wff-cohort-20/cards",{method:"POST",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(n),length:0})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))).then((function(e){q.prepend(o(e,ne,oe,re,h))})).then((function(){p(!1),u(A,D)})).catch((function(e){return console.error(e)}))})),H.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=ee.id,fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/".concat(t),{method:"DELETE",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))).then((function(){ee.cardElement.remove(),u(x,B),ee={}})).catch((function(e){return console.error(e)}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),p(!0),(t=Q.value,fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me/avatar",{method:"PATCH",headers:{authorization:"f77c1491-65dc-47b9-987d-f5e30fa375da","Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.error(e)}))).then((function(e){X.setAttribute("style","background-image: url(".concat(e.avatar,");"))})).then((function(){p(!1),u(P,M)})).catch((function(e){return console.error(e)}))}))})();